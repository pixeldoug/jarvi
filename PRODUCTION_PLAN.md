# üöÄ Jarvi - Production Deployment Plan

## üìã Overview

This document outlines the complete step-by-step plan to deploy Jarvi to production across all platforms: Backend API, Web Application, and Mobile App.

## üéØ Deployment Strategy

**Recommended Order:**
1. **Google Cloud Console** (Foundation - Required for all platforms)
2. **Backend API** (Railway) - Core dependency
3. **Web Application** (Vercel) - Easiest to test
4. **Mobile Application** (Expo/EAS) - Most complex

**Timeline:** 7-10 days total
- **Preparation:** 2 days
- **Backend:** 1-2 days  
- **Web:** 1 day
- **Mobile:** 2-3 days
- **Testing & Refinement:** 1-2 days

## üìÖ Phase 1: Preparation (Days 1-2)

### ‚úÖ Day 1: Google Cloud Console Setup

**üéØ Goal:** Configure OAuth for all platforms

**Steps:**
1. **Create Production Project**
   - Go to [Google Cloud Console](https://console.cloud.google.com/)
   - Create new project: "Jarvi Production"
   - Note project ID for reference

2. **Enable Required APIs**
   ```
   - People API (recommended)
   - Google+ API (legacy backup)
   ```

3. **Configure OAuth Consent Screen**
   - Type: **External** (for public use)
   - App name: **Jarvi**
   - User support email: Your email
   - Developer contact: Your email
   - Add your email as test user initially

4. **Create OAuth 2.0 Client IDs**
   
   **Web Application:**
   - Name: `Jarvi Web Production`
   - Authorized JavaScript origins:
     ```
     https://jarvi.app
     https://www.jarvi.app
     ```
   - Authorized redirect URIs:
     ```
     https://jarvi.app/auth/callback
     https://www.jarvi.app/auth/callback
     ```
   - **Save Client ID** üìù

   **iOS Application:**
   - Name: `Jarvi iOS Production`
   - Bundle ID: `com.jarvi.app`
   - **Save Client ID** üìù

   **Android Application:**
   - Name: `Jarvi Android Production`
   - Package name: `com.jarvi.app`
   - SHA-1 certificate fingerprint: (Generate with EAS)
   - **Save Client ID** üìù

### ‚úÖ Day 2: Local Testing with Production Credentials

**üéØ Goal:** Verify OAuth works with production credentials

**Steps:**
1. **Update Local Environment Files**
   ```bash
   # packages/backend/.env
   GOOGLE_CLIENT_ID=your-production-web-client-id
   
   # packages/web/.env.local  
   VITE_GOOGLE_CLIENT_ID=your-production-web-client-id
   
   # packages/mobile/.env
   GOOGLE_CLIENT_ID=your-production-ios-client-id
   ```

2. **Test Authentication Flow**
   ```bash
   # Start all services
   npm run dev:all
   
   # Test web login at http://localhost:3000
   # Test mobile login in simulator
   # Verify sync between platforms
   ```

3. **Verify Database Schema**
   ```bash
   sqlite3 packages/backend/jarvi.db ".schema"
   # Ensure all tables are properly structured
   ```

**‚úÖ Deliverables:**
- [ ] Google Cloud Console project configured
- [ ] OAuth Client IDs for all platforms
- [ ] Local testing successful with production credentials
- [ ] Database schema verified

---

## üìÖ Phase 2: Backend Deployment (Days 3-4)

### ‚úÖ Day 3: Railway Setup & Database Migration

**üéØ Goal:** Deploy backend API with PostgreSQL

**Platform Choice: Railway**
- ‚úÖ Built-in PostgreSQL
- ‚úÖ Automatic HTTPS
- ‚úÖ GitHub integration
- ‚úÖ Environment variables UI
- ‚úÖ Real-time logs

**Steps:**
1. **Prepare Backend for Production**
   ```bash
   cd packages/backend
   
   # Add production scripts to package.json
   npm pkg set scripts.start="node dist/index.js"
   npm pkg set scripts.build="tsc"
   
   # Test production build
   npm run build
   npm run start
   ```

2. **Create Railway Project**
   - Go to [Railway](https://railway.app/)
   - Sign up with GitHub
   - Click "New Project" ‚Üí "Deploy from GitHub repo"
   - Select your Jarvi repository
   - Set root directory: `packages/backend`

3. **Configure Environment Variables**
   ```bash
   # In Railway dashboard ‚Üí Variables tab:
   NODE_ENV=production
   PORT=3000
   JWT_SECRET=your-super-secure-jwt-secret-64-chars-minimum
   GOOGLE_CLIENT_ID=your-production-web-client-id
   CORS_ORIGIN=https://your-domain.vercel.app
   # DATABASE_URL will be auto-generated by Railway PostgreSQL
   ```

4. **Add PostgreSQL Database**
   - In Railway dashboard ‚Üí "New" ‚Üí "Database" ‚Üí "PostgreSQL"
   - Railway automatically sets DATABASE_URL

5. **Update Database Code for PostgreSQL**
   ```typescript
   // packages/backend/src/database/index.ts
   // Code already supports DATABASE_URL environment variable
   // PostgreSQL will work automatically
   ```

### ‚úÖ Day 4: Backend Testing & Optimization

**üéØ Goal:** Verify API functionality and performance

**Steps:**
1. **Test API Endpoints**
   ```bash
   # Health check
   curl https://your-railway-app.up.railway.app/health
   
   # Test authentication (use Postman for complex requests)
   curl -X POST https://your-railway-app.up.railway.app/api/auth/google \
     -H "Content-Type: application/json" \
     -d '{"idToken":"test-token"}'
   ```

2. **Monitor Logs**
   ```bash
   # In Railway dashboard ‚Üí Deployments ‚Üí View Logs
   # Check for any errors or warnings
   ```

3. **Performance Testing**
   ```bash
   # Test response times
   curl -w "@curl-format.txt" -o /dev/null -s https://your-railway-app.up.railway.app/health
   ```

4. **Database Migration Verification**
   ```bash
   # Check if all tables were created correctly
   # Railway provides database access through their dashboard
   ```

**‚úÖ Deliverables:**
- [ ] Backend deployed to Railway
- [ ] PostgreSQL database configured and migrated
- [ ] All API endpoints responding correctly
- [ ] Environment variables configured
- [ ] Logs showing no errors

---

## üìÖ Phase 3: Web Application Deployment (Day 5)

### ‚úÖ Web Deployment on Vercel

**üéØ Goal:** Deploy React web app with production API

**Platform Choice: Vercel**
- ‚úÖ Perfect for React/Vite
- ‚úÖ Automatic HTTPS & CDN
- ‚úÖ GitHub integration
- ‚úÖ Environment variables UI
- ‚úÖ Instant deployments

**Steps:**
1. **Prepare Web App**
   ```bash
   cd packages/web
   
   # Test production build
   npm run build
   npm run preview  # Test locally
   ```

2. **Deploy to Vercel**
   - Go to [Vercel](https://vercel.com/new)
   - Import from GitHub
   - Select Jarvi repository
   - Framework: **Vite**
   - Root Directory: `packages/web`
   - Build Command: `npm run build`
   - Output Directory: `dist`

3. **Configure Environment Variables**
   ```bash
   # In Vercel dashboard ‚Üí Settings ‚Üí Environment Variables:
   VITE_API_URL=https://your-railway-app.up.railway.app
   VITE_GOOGLE_CLIENT_ID=your-production-web-client-id
   VITE_APP_NAME=Jarvi
   ```

4. **Update CORS in Backend**
   ```bash
   # Update Railway environment variable:
   CORS_ORIGIN=https://your-vercel-app.vercel.app
   ```

5. **Test Web Application**
   ```bash
   # Visit your Vercel URL
   # Test Google OAuth login
   # Test task creation/sync
   # Test all major features
   ```

6. **Custom Domain (Optional)**
   ```bash
   # In Vercel dashboard ‚Üí Settings ‚Üí Domains
   # Add your custom domain (jarvi.app)
   # Update Google OAuth origins accordingly
   ```

**‚úÖ Deliverables:**
- [ ] Web app deployed to Vercel
- [ ] Environment variables configured
- [ ] Google OAuth working in production
- [ ] Task sync working with backend
- [ ] Custom domain configured (optional)

---

## üìÖ Phase 4: Mobile Application Deployment (Days 6-8)

### ‚úÖ Day 6: Expo/EAS Setup

**üéØ Goal:** Prepare mobile app for store deployment

**Platform Choice: Expo Application Services (EAS)**
- ‚úÖ Managed React Native builds
- ‚úÖ App Store & Play Store integration
- ‚úÖ Over-the-air updates
- ‚úÖ Professional build pipeline

**Steps:**
1. **Install EAS CLI**
   ```bash
   npm install -g @expo/cli
   npm install -g eas-cli
   
   # Login to Expo
   eas login
   ```

2. **Configure EAS Build**
   ```bash
   cd packages/mobile
   
   # Initialize EAS
   eas build:configure
   ```

3. **Update app.config.js for Production**
   ```javascript
   export default {
     expo: {
       name: "Jarvi",
       slug: "jarvi",
       version: "1.0.0",
       orientation: "portrait",
       icon: "./assets/icon.png",
       userInterfaceStyle: "light",
       splash: {
         image: "./assets/splash-icon.png",
         resizeMode: "contain",
         backgroundColor: "#6366f1"
       },
       assetBundlePatterns: ["**/*"],
       ios: {
         supportsTablet: true,
         bundleIdentifier: "com.jarvi.app",
         buildNumber: "1.0.0"
       },
       android: {
         adaptiveIcon: {
           foregroundImage: "./assets/adaptive-icon.png",
           backgroundColor: "#6366f1"
         },
         package: "com.jarvi.app",
         versionCode: 1
       },
       web: {
         favicon: "./assets/favicon.png"
       },
       extra: {
         googleClientId: process.env.GOOGLE_CLIENT_ID,
         apiBaseUrl: process.env.EXPO_PUBLIC_API_URL || "https://your-railway-app.up.railway.app/api",
         appName: process.env.EXPO_PUBLIC_APP_NAME || "Jarvi",
         eas: {
           projectId: "your-eas-project-id"
         }
       }
     }
   };
   ```

4. **Update Production Environment**
   ```bash
   # packages/mobile/.env
   EXPO_PUBLIC_API_URL=https://your-railway-app.up.railway.app/api
   GOOGLE_CLIENT_ID=your-production-ios-client-id
   EXPO_PUBLIC_APP_NAME=Jarvi
   ```

### ‚úÖ Day 7: iOS Build & TestFlight

**üéØ Goal:** Deploy to TestFlight for testing

**Steps:**
1. **iOS Build**
   ```bash
   # Build for iOS
   eas build --platform ios
   
   # Monitor build progress
   # This will take 10-20 minutes
   ```

2. **App Store Connect Setup**
   - Go to [App Store Connect](https://appstoreconnect.apple.com/)
   - Create new app: "Jarvi"
   - Bundle ID: `com.jarvi.app`
   - Configure app information

3. **TestFlight Distribution**
   ```bash
   # After build completes, EAS provides .ipa file
   # Upload to TestFlight through EAS or manually
   eas submit --platform ios
   ```

4. **Add TestFlight Testers**
   - Add yourself as internal tester
   - Test core functionality
   - Verify Google OAuth works
   - Test sync with web app

### ‚úÖ Day 8: Android Build & Internal Testing

**üéØ Goal:** Deploy to Google Play Internal Testing

**Steps:**
1. **Generate SHA-1 Certificate**
   ```bash
   # EAS will generate automatically, or:
   eas credentials
   ```

2. **Update Google Cloud Console**
   - Add generated SHA-1 to Android OAuth client
   - This enables Google OAuth on Android

3. **Android Build**
   ```bash
   # Build for Android
   eas build --platform android
   
   # Monitor build progress
   ```

4. **Google Play Console Setup**
   - Go to [Google Play Console](https://play.google.com/console/)
   - Create new app: "Jarvi"
   - Upload APK/AAB from EAS build

5. **Internal Testing**
   ```bash
   # Submit to internal testing track
   eas submit --platform android
   ```

**‚úÖ Deliverables:**
- [ ] iOS app in TestFlight
- [ ] Android app in Internal Testing
- [ ] Google OAuth working on both platforms
- [ ] Sync functionality verified
- [ ] Core features tested

---

## üìÖ Phase 5: Testing & Launch (Days 9-10)

### ‚úÖ Day 9: Comprehensive Testing

**üéØ Goal:** End-to-end testing across all platforms

**Testing Checklist:**
- [ ] **Authentication**
  - [ ] Google OAuth on web
  - [ ] Google OAuth on iOS
  - [ ] Google OAuth on Android
  - [ ] JWT token persistence
  - [ ] Logout functionality

- [ ] **Core Features**
  - [ ] Task creation on web ‚Üí appears on mobile
  - [ ] Task creation on mobile ‚Üí appears on web
  - [ ] Task completion sync
  - [ ] Task editing sync
  - [ ] Task deletion sync

- [ ] **Performance**
  - [ ] Web app loads < 3 seconds
  - [ ] Mobile app starts < 5 seconds
  - [ ] API responses < 500ms
  - [ ] Database queries optimized

- [ ] **Security**
  - [ ] HTTPS on all endpoints
  - [ ] JWT tokens secure
  - [ ] CORS properly configured
  - [ ] No sensitive data in logs

### ‚úÖ Day 10: Launch Preparation

**üéØ Goal:** Final preparations for public launch

**Steps:**
1. **Documentation Updates**
   - Update README.md with production URLs
   - Create user guide/help documentation
   - Prepare changelog for v1.0.0

2. **Monitoring Setup**
   ```bash
   # Railway provides built-in monitoring
   # Vercel provides analytics
   # Consider adding Sentry for error tracking
   ```

3. **Backup Strategy**
   ```bash
   # Railway provides automatic PostgreSQL backups
   # Document backup/restore procedures
   ```

4. **Launch Checklist**
   - [ ] All environments stable
   - [ ] Error monitoring active
   - [ ] Support documentation ready
   - [ ] App store listings complete
   - [ ] Marketing materials prepared

**‚úÖ Deliverables:**
- [ ] All platforms tested and stable
- [ ] Monitoring and alerting configured
- [ ] Documentation complete
- [ ] Ready for public launch

---

## üõ†Ô∏è Production Environment Summary

### üîó Final Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Web App       ‚îÇ    ‚îÇ   Mobile App    ‚îÇ    ‚îÇ   Backend API   ‚îÇ
‚îÇ   (Vercel)      ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (App Stores)  ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Railway)     ‚îÇ
‚îÇ   jarvi.app     ‚îÇ    ‚îÇ   iOS/Android   ‚îÇ    ‚îÇ   + PostgreSQL  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Google OAuth 2.0   ‚îÇ
                    ‚îÇ  Authentication     ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üìä Production URLs

- **Web App:** `https://jarvi.app`
- **Backend API:** `https://your-app.up.railway.app`
- **iOS App:** TestFlight ‚Üí App Store
- **Android App:** Internal Testing ‚Üí Play Store

### üí∞ Estimated Monthly Costs

- **Railway:** $0-5 (free tier initially)
- **Vercel:** $0 (free tier)
- **Expo EAS:** $0-29 (depending on builds)
- **Google Cloud:** $0 (OAuth is free)
- **Total:** $0-34/month initially

### üîÑ Maintenance Plan

**Weekly:**
- [ ] Monitor error rates
- [ ] Check performance metrics
- [ ] Review user feedback

**Monthly:**
- [ ] Update dependencies
- [ ] Security patches
- [ ] Feature updates
- [ ] Backup verification

## üö® Troubleshooting Guide

### Common Issues & Solutions

**Google OAuth Errors:**
```bash
# Check Client IDs match environment
# Verify authorized origins/redirects
# Ensure OAuth consent screen approved
```

**CORS Errors:**
```bash
# Update CORS_ORIGIN in Railway
# Match exact domain (with/without www)
```

**Database Connection Issues:**
```bash
# Check DATABASE_URL in Railway
# Verify PostgreSQL service running
# Check connection limits
```

**Mobile Build Failures:**
```bash
# Clear EAS cache: eas build --clear-cache
# Check app.config.js syntax
# Verify certificates valid
```

## üìû Support Resources

- **Railway:** [docs.railway.app](https://docs.railway.app)
- **Vercel:** [vercel.com/docs](https://vercel.com/docs)
- **Expo:** [docs.expo.dev](https://docs.expo.dev)
- **Google OAuth:** [developers.google.com/identity](https://developers.google.com/identity)

---

## ‚úÖ Success Criteria

**Launch is successful when:**
- [ ] All three platforms (web, iOS, Android) are live
- [ ] Google OAuth works on all platforms
- [ ] Real-time sync works between all platforms
- [ ] Core features (tasks, notes, habits, finances) functional
- [ ] Performance meets targets (< 3s web, < 5s mobile)
- [ ] Error rates < 1%
- [ ] User feedback positive

**üéâ Ready to launch when all checkboxes are complete!**

